{
    "collab_server" : "",
    "contents" : "\n\n##############  extra functions for the covtpx R package   ##################\n\nnsamples <- 38\nK <- 3\nnum_covars <- 2\nG <- 304\n\nomega <- rdirichlet(nsamples, alpha = rep(1/K, K))\ntheta <- rdirichlet(nsamples*K, alpha = rep(1/(K*G), G))\n\n# theta <- cbind(replicate(nsamples, initopics[,1]), replicate(nsamples, initopics[,2]),\n#                replicate(nsamples, initopics[,3]))\n\ncluster_fac <- rep(1:K, each = nsamples)\nmetadata <- matrix(sample(1:100, nsamples*num_covars, replace=TRUE), nsamples, num_covars)\n\nmetadata2 <- do.call(rbind, replicate(3, metadata, simplify=FALSE))\n\nlibrary_size <- c(replicate(3, rowSums(counts)))\nomega_2 <- c(omega)\n\ntmp1 <- c(omega_2)\ntmp2 <- sweep(theta, 1, tmp1, \"*\")\n\ntmp3 <- tmp2\ndim(tmp3) <- c(nsamples, K, G)\ntmp3_normed <- aperm(apply(tmp3, c(1, 3), function(x) {\n                                      if(sum(x) == 0){\n                                        return(rep(1/length(x), length(x)))\n                                        }else{\n                                        return(x/sum(x))\n                                        }}), c(2,1,3))\n\ntmp3_normed_simplified <- tmp3_normed\ndim(tmp3_normed_simplified) <- c(nsamples*K, G)\n\ncounts_repped <- do.call(rbind, replicate(3, counts, simplify=FALSE))\n\nlatent_counts <- counts_repped * tmp3_normed_simplified\n\nlatent_counts_array <- latent_counts\n\ntemp <- latent_counts_array[which(cluster_fac == 1), ] + latent_counts_array[which(cluster_fac == 2), ] + latent_counts_array[which(cluster_fac == 3), ]\n\ndim(latent_counts_array) <- c(nsamples, K, G)\n\nlibrary(distrom)\ncl <- makeCluster(4,type=ifelse(.Platform$OS.type==\"unix\",\"FORK\",\"PSOCK\"))\nprint(cl)\n\ndim(metadata2)\nmetadata_cluster <- model.matrix(~factor(cluster_fac)-1)\nmetadata3 <- cbind(metadata2, metadata_cluster)\ncolnames(metadata3) <-  c(\"meta1\", \"meta2\", \"clus1\", \"clus2\", \"clus3\")\n\nfits <- dmr(cl, metadata3, latent_counts, verb=1)\nstopCluster(cl)\n###  this fit should run  ##########################\n\n########  extracting the coefficients from this fit   #####################\n\ncoef_fitted <- coef.dmr(fits)\nmetadata4 <- cbind(rep(1, dim(counts_repped)[1]), metadata3)\n\nfitted_val <- exp(metadata4 %*% coef_fitted)\nfitted_val_2 <- t(apply(fitted_val, 1, function(x) return(x/sum(x))))\n\nnew_theta <- fitted_val_2\n\n\n",
    "created" : 1504639788346.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2147926260",
    "id" : "B9801043",
    "lastKnownWriteTime" : 1504653753,
    "last_content_update" : 1504654716948,
    "path" : "~/Documents/covtpx/vignettes/extras.R",
    "project_path" : "vignettes/extras.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 7,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}